<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anjo da Guarda — Cadastro Freemium | 3G Brasil</title>
  <meta name="description" content="Cadastro para receber o link de download do plano gratuito do Anjo da Guarda." />
  <meta name="robots" content="noindex,nofollow">

  <link rel="stylesheet" href="assets/site.css?v=4">
</head>
<body>

  <header>
    <div class="logo-band">
      <img src="assets/logo.png" alt="3G Brasil" loading="lazy" />
    </div>
    <nav>
      <a href="/">3G Brasil</a>
      <a href="/#produtos">Produtos</a>
      <a href="/contact.html">Contato</a>
    </nav>
  </header>

  <main class="container" style="max-width:720px;">
    <section class="hero">
      <h1>Cadastro Freemium</h1>
      <p>Preencha seus dados para receber por e-mail o link de download do plano gratuito.</p>
    </section>

    <section class="card">
      <form id="free-form" novalidate>
        <div style="display:grid; gap:12px;">
          <label>
            <strong>Nome</strong><br>
            <input id="nome" name="nome" type="text" required minlength="2"
                   autocomplete="name" style="width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:10px;">
          </label>

          <label>
            <strong>E-mail</strong><br>
            <input id="email" name="email" type="email" required
                   autocomplete="email" style="width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:10px;">
          </label>

          <label>
            <strong>Celular</strong><br>
            <input id="celular" name="celular" type="tel" required
                   inputmode="tel" placeholder="(11) 99999-9999"
                   style="width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:10px;">
          </label>

          <label>
            <strong>CEP</strong><br>
            <input id="cep" name="cep" type="text" required
                   inputmode="numeric" placeholder="00000-000"
                   style="width:100%; padding:10px; border:1px solid #e5e7eb; border-radius:10px;">
          </label>

          <div id="err" class="card-note" style="display:none; color:#b91c1c; font-weight:600;"></div>

          <button id="btn" type="submit" class="btn-link" style="width:100%;">
            Enviar e receber por e-mail
          </button>

          <p class="card-note" style="margin:0;">
            Ao enviar, você concorda com os <a href="/terms.html" target="_blank" rel="noopener">Termos</a> e
            a <a href="/privacy.html" target="_blank" rel="noopener">Política de Privacidade</a>.
          </p>
        </div>
      </form>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-wrap">
        <div class="support">
          <p class="footer-support-title">Suporte</p>
          <p class="footer-support-info">
            <a href="mailto:comercial@3g-brasil.com">comercial@3g-brasil.com</a>
          </p>
        </div>
        <div class="legal">
          <p class="footer-legal">CNPJ: 30.589.513/0001-40</p>
          <p class="footer-copy">© 2025 3G Brasil — 3g-brasil.com</p>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // ✅ Backend Financeiro (API pública)
    // Ajuste se seu domínio público do Financeiro for diferente:
    const FIN_BASE = "https://financeiro.3g-brasil.com";

    // ✅ Rota nova (recomendada) no Financeiro:
    const ENDPOINT = FIN_BASE + "/api/financeiro/free/signup";

    function showErr(msg){
      const el = document.getElementById("err");
      el.textContent = msg;
      el.style.display = "block";
    }
    function clearErr(){
      const el = document.getElementById("err");
      el.textContent = "";
      el.style.display = "none";
    }

    function normDigits(s){ return (s||"").replace(/\D+/g,""); }

    document.getElementById("free-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      clearErr();

      const btn = document.getElementById("btn");
      btn.disabled = true;
      const oldTxt = btn.textContent;
      btn.textContent = "Enviando...";

      try{
        const nome = (document.getElementById("nome").value || "").trim();
        const email = (document.getElementById("email").value || "").trim();
        const celularRaw = (document.getElementById("celular").value || "").trim();
        const cepRaw = (document.getElementById("cep").value || "").trim();

        if (nome.length < 2) throw new Error("Informe seu nome.");
        if (!email.includes("@")) throw new Error("Informe um e-mail válido.");
        const celular = normDigits(celularRaw);
        const cep = normDigits(cepRaw);

        if (celular.length < 10) throw new Error("Informe um celular válido.");
        if (cep.length !== 8) throw new Error("Informe um CEP válido (8 dígitos).");

        const payload = { nome, email, celular, cep, ref: "planogratuito" };

        const r = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await r.json().catch(() => ({}));

        if (!r.ok){
          const msg = (data && (data.detail || data.error || data.message)) || "Falha ao enviar. Tente novamente.";
          throw new Error(msg);
        }

        // ✅ Não mostra nada na tela: volta pro site
        window.location.href = "/";

      } catch(err){
        showErr(err && err.message ? err.message : "Erro inesperado. Tente novamente.");
        btn.disabled = false;
        btn.textContent = oldTxt;
      }
    });
  </script>

</body>
</html>